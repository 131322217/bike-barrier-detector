<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Barrier Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyAb9Zt2Hw_o-wXfXby6vlBDdcWZ6xZUJpo",
  authDomain: "bike-barrier-detector-1e128.firebaseapp.com",
  projectId: "bike-barrier-detector-1e128"
});
const db = getFirestore(app);

const map = L.map("map").setView([35.68, 139.76], 15);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

const snap = await getDocs(collection(db, "logs"));

snap.forEach(doc => {
  const d = doc.data();
  const color = d.type === "step" ? "red" : "blue";

  L.circleMarker([d.lat, d.lng], {
    radius: 6,
    color,
    fillOpacity: 0.7
  }).addTo(map);
});
</script>
</body>
</html>
